# Please read the pdf before going ahead

# CMM Coding.zip
CMM Coding.zip file has a coding of Coordinate measuring machine and calibration data

# Data: 

NOTE: Calibration points are different from assembled points (Pdf)

Calibrated Hexapod: 

        Fixed Platform
        Moving Platform
        Assembled all legs Zero
        Assembled  change 5 6 legs +4 mm

Fixed Platform:

        CORNOR1    	            THEO/<-82.5,112.5,0>,<-1,0,0>	            ACTL/<-82.468,112.527,0.002>,<-0.9999997,0.0000663,0.000812>
        CORNOR2    	            THEO/<82.5,112.5,0>,<0,0,1>	            ACTL/<82.493,112.516,-0.132>,<-0.0007324,0.0030107,0.9999952>
        CORNOR3    	            THEO/<82.5,-112.5,0>,<0,0,1>	            ACTL/<82.447,-112.499,0.568>,<-0.000733,0.0000002,0.9999997>
        CORNOR4    	            THEO/<-82.5,-112.5,0>,<0,0,-1>	            ACTL/<-82.468,-112.465,0.702>,<0,0,-1>
        LEG_CENTRE_1	            THEO/<61.08,22.231,-11>,<0,0,1>	            ACTL/<61.06,22.233,-10.803>,<0.0004847,0.0034285,0.999994>
        LEG_CENTRE_2	            THEO/<-11.287,64.013,-11>,<0,0,1>	            ACTL/<-11.3,64.009,-10.898>,<0.0009114,0.0037219,0.9999927>
        LEG_CENTRE_3	            THEO/<-49.793,41.781,-11>,<0,0,1>	            ACTL/<-49.825,41.784,-10.779>,<0.0012924,0.0036046,0.9999927>
        LEG_CENTRE_4	            THEO/<-49.793,-41.781,-11>,<0,0,1>	            ACTL/<-49.834,-41.765,-10.52>,<0.00109,0.003147,0.9999945>
        LEG_CENTRE_5	            THEO/<-11.287,-64.013,-11>,<0,0,1>	            ACTL/<-11.327,-63.988,-10.504>,<0.0006666,0.0030836,0.999995>
        LEG_CENTRE_6	            THEO/<61.08,-22.231,-11>,<0,0,1>	            ACTL/<61.058,-22.228,-10.654>,<0.0005216,0.0032783,0.9999945>
        CENTRE_CIRCLE_CENTRE	            THEO/<0,0,0>,<0,0,1>	            ACTL/<0.015,0.025,0.285>,<0.000489,0.0030945,0.9999951>


Moving Platform:


        CORNOR1    	            THEO/<-82.5,112.5,0>,<0,0,-1>	            ACTL/<-82.474,112.483,-0.029>,<0,-0.0015488,-0.9999988>
        CORNOR2    	            THEO/<82.5,112.5,0>,<0,0,-1>	            ACTL/<82.459,112.49,-0.407>,<0.0011578,-0.0015488,-0.9999981>
        CORNOR3    	            THEO/<82.5,-112.5,0>,<0,0,-1>	            ACTL/<82.466,-112.432,-0.052>,<0.0011577,0.0000006,-0.9999993>
        CORNOR4    	            THEO/<-82.5,-112.5,0>,<0,0,-1>	            ACTL/<-82.474,-112.517,0.326>,<0,0,-1>
        LEG_CENTRE_1	            THEO/<58.731,21.376,-11>,<0,0,1>	            ACTL/<58.704,21.364,-11.243>,<0.0020898,0.0016651,0.9999964>
        LEG_CENTRE_2	            THEO/<-10.853,61.55,-11>,<0,0,1>	            ACTL/<-10.873,61.536,-11.135>,<0.0022517,0.0015893,0.9999962>
        LEG_CENTRE_3	            THEO/<-47.878,40.174,-11>,<0,0,1>	            ACTL/<-47.907,40.162,-11.017>,<0.0019364,0.0015196,0.999997>
        LEG_CENTRE_4	            THEO/<-47.878,-40.174,-11>,<0,0,1>	            ACTL/<-47.912,-40.187,-10.888>,<0.0023093,0.0016937,0.9999959>
        LEG_CENTRE_5	            THEO/<-10.853,-61.55,-11>,<0,0,1>	            ACTL/<-10.875,-61.556,-10.94>,<0.0023827,0.0017795,0.9999956>
        LEG_CENTRE_6	            THEO/<58.731,-21.376,-11>,<0,0,1>	            ACTL/<58.708,-21.383,-11.171>,<0.0021745,0.0016568,0.9999963>
        CENTRE_CIRCLE_CENTRE	            THEO/<0,0,0>,<0,0,1>	            ACTL/<0.013,-0.024,-0.04>,<0.0025942,0.0016802,0.9999952>


Stewart Platform (Hexapod): All Legs at Zero:

        B1	            THEO/<-82.5,112.5,0>,<1,0,0>	            ACTL/<-82.478,112.495,-0.004>,<0.9999997,0.0000846,0.0007034>
        B2	            THEO/<82.5,112.5,0>,<0,-1,0>	            ACTL/<82.454,112.508,0.112>,<0.0002142,-0.9999999,-0.0004765>
        B3	            THEO/<82.5,-112.5,0>,<0,-1,0>	            ACTL/<82.502,-112.489,0.004>,<0.0002142,-0.9999999,-0.0004765>
        B4	            THEO/<-82.5,-112.5,0>,<-1,0,0>	            ACTL/<-82.478,-112.513,-0.112>,<-0.9999997,-0.0001421,-0.0007034>
        P1	            THEO/<-82.5,112.5,181.195>,<-1,0,0.0000022>	            ACTL/<-78.089,115.325,180.165>,<-0.9995178,0.0310181,0.0014296>
        P2	            THEO/<82.5,112.5,181.194>,<0,1,-0.0000003>	            ACTL/<86.773,110.209,179.929>,<0.0305042,0.999533,0.0018166>
        P3	            THEO/<82.5,-112.5,181.195>,<0,0,-1>	            ACTL/<79.912,-114.609,179.521>,<-0.0049809,0.0024965,-0.9999845>
        P4	            THEO/<-82.5,-112.5,181.195>,<0,-1,0.0000003>	            ACTL/<-84.943,-109.583,179.756>,<-0.0304627,-0.9995343,-0.0018166>


Stewart Platform (Hexapod): ALL legs Zero except (5,6 at 4mm+):

        B1	            THEO/<-82.5,112.5,0>,<1,0,0>	            ACTL/<-82.477,112.496,-0.004>,<0.9999997,0.0000616,0.0007845>
        B2	            THEO/<82.5,112.5,0>,<0,-1,0>	            ACTL/<82.452,112.506,0.125>,<0.0002286,-0.9999998,-0.0005363>
        B3	            THEO/<82.5,-112.5,0>,<0,-1,0>	            ACTL/<82.503,-112.49,0.004>,<0.0002286,-0.9999998,-0.0005363>
        B4	            THEO/<-82.5,-112.5,0>,<-1,0,0>	            ACTL/<-82.477,-112.511,-0.125>,<-0.9999997,-0.0001295,-0.0007846>
        P1	            THEO/<-82.5,112.5,181.195>,<-1,0,0.0000022>	            ACTL/<-85.125,127.502,176.101>,<-0.9993516,0.0311372,-0.0180786>
        P2	            THEO/<82.5,112.5,181.194>,<0,1,-0.0000002>	            ACTL/<79.718,122.365,179.083>,<0.0311885,0.9991445,-0.0271593>
        P3	            THEO/<82.5,-112.5,181.195>,<0,0,-1>	            ACTL/<72.703,-102.365,185.192>,<0.0141408,-0.0276023,-0.999519>
        P4	            THEO/<-82.5,-112.5,181.195>,<0,-1,0.0000002>	            ACTL/<-92.131,-97.306,182.212>,<-0.0311391,-0.999146,0.0271602>



# Inverse Kinematics of the Stewart Platform (Hexapod)

Input:

        desired_position (mm)   = [ X; Y; Z] 3x1 matrix
        desired_orientation (deg)  = [rotX; rotY; totZ] 3x1 matrix
        
output:

        6 Leg lengths  in mm (leg_lengths) 1x6 Matrix

CODE   

                % Define the desired position and orientation of the moving platform
                % %calibreation 1 (All legs Zero)
                % desired_position = [.9133; .3355; 179.8]; % Desired position [x, y, z]
                % desired_orientation = [.1066; 0.07871; -1.778]*pi/180; % Desired orientation [roll, pitch, yaw] In DEGREE
                
                % Calibration 2 (5 6 legs + 4 mm)
                desired_position = [-6.209; 12.55; 180.6]; % Desired position [x, y, z]
                desired_orientation = [-1.588; -.9865; -1.813]*pi/180; % Desired orientation [roll, pitch, yaw] In DEGREE
                
                
                % R1=130/2; %radious of the base frame
                % R2=125/2; %radious of the moving frame
                % GAMMA=20; % half angle between to adjacent legs
                
                
                % Define the fixed and moving platform geometry (attachment points)
                % Fixed platform attachment points (in the base frame)
                        % B1=[R1*cosd(60-GAMMA) R1*sind(60-GAMMA) 0]'; 
                        % B2=[R1*cosd(60+GAMMA) R1*sind(60+GAMMA) 0]'; 
                        % B3=[-R1*cosd(GAMMA) R1*sind(GAMMA) 0]'; 
                        % B4=[-R1*cosd(GAMMA) -R1*sind(GAMMA) 0]'; 
                        % B5=[R1*cosd(60+GAMMA) -R1*sind(60+GAMMA) 0]'; 
                        % B6=[R1*cosd(60-GAMMA) -R1*sind(60-GAMMA) 0]'; 
                
                %%% Actual Base Points
                B1=[49.834,41.765,-10.52+11]'; 
                B2=[11.327,63.988,-10.504+11]'; 
                B3=[-61.058, 22.228,-10.654+11]'; 
                B4=[-61.06,-22.233,-10.803+11]'; 
                B5=[11.3,-64.009,-10.898+11]'; 
                B6=[49.825,-41.784,-10.779+11]'; 
                
                B = [B1 B2 B3 B4 B5 B6];
                
                % Moving platform attachment points (in the moving frame)
                        % P1=[R2*cosd(GAMMA) R2*sind(GAMMA) 0]';
                        % P2=[-R2*sind(30-GAMMA) R2*cosd(30-GAMMA) 0]';
                        % P3=[-R2*sind(30+GAMMA) R2*cosd(30+GAMMA) 0]';
                        % P4=[-R2*sind(30+GAMMA) -R2*cosd(30+GAMMA) 0]';
                        % P5=[-R2*sind(30-GAMMA) -R2*cosd(30-GAMMA) 0]';
                        % P6=[R2*cosd(GAMMA) -R2*sind(GAMMA) 0]';
                
                %%% Actual Top Points
                P1=[58.708,21.383,-11.171+11]';
                P2=[-10.875,61.556,-10.94+11]';
                P3=[-47.912,40.187,-10.888+11]';
                P4=[-47.907,-40.162,-11.017+11]';
                P5=[-10.873,-61.536,-11.135+11]';
                P6=[58.704,-21.364,-11.243+11]';
                
                P = [P1 P2 P3 P4 P5 P6];
                
                
                % Solve inverse kinematics to find the lengths of each leg
                leg_lengths = inverseKinematics(desired_position, desired_orientation, B, P);
                
                % Display the Stewart platform
                [R, P_global, top_centre] = displayStewartPlatform(desired_position, desired_orientation, B, P);

                
Functions:

                function leg_lengths = inverseKinematics(desired_position, desired_orientation, B, P)
                    % Convert orientation to rotation matrix
                    R = Eul2rotm(desired_orientation);
                
                    % Calculate leg lengths
                    leg_lengths = zeros(6, 1);
                    disp("Leg Lengths are:")
                    for i = 1:6
                        % Position of attachment point on moving platform in world frame
                        Pi = desired_position + R * P(:, i);
                        
                        % Vector from base attachment point to moving platform attachment point
                        L = Pi - B(:, i);
                        
                        % Leg length
                        leg_lengths(i) = norm(L);
                        disp(leg_lengths(i))
                    end
                
                end
                
                
                % Utility function to convert Euler angles to rotation matrix
                function R = Eul2rotm(eul)
                    % Assuming Euler angles are in the order of [roll, pitch, yaw]
                    R = eul2rotm([eul(1), eul(2), eul(3)],"XYZ");
                end
                
                function [R, P_global, top_centre] = displayStewartPlatform(desired_position, desired_orientation, B, P)
                    % Convert orientation to rotation matrix
                    R = Eul2rotm(desired_orientation);
                    P_global = desired_position + R * P;
                
                
                    figure;
                    hold on;
                %%%%%%%%%%%%%%%%% Plotting Rectangle
                
                    RP1 = [-82.5,112.5,0]';
                    RP2 = [82.5,112.5,0]';
                    RP3 = [82.5,-112.5,0]';
                    RP4 = [-82.5,-112.5,0]';
                    Rectangle_points = [RP1 RP2 RP3 RP4];
                    P_rect_global = desired_position + R * Rectangle_points
                
                    % Plot the Rectangular attachment points
                    plot3(P_rect_global(1,:), P_rect_global(2,:), P_rect_global(3,:), 'bo', 'MarkerSize', 10, 'MarkerFaceColor', 'b');
                    fill3(P_rect_global(1,:), P_rect_global(2,:), P_rect_global(3,:),'b','FaceAlpha', 0.05);
                    text(P_rect_global(1,:), P_rect_global(2,:), P_rect_global(3,:), {'Cornor1', 'Cornor2', 'Cornor3', 'Cornor4'}, 'VerticalAlignment', 'bottom',                                 'HorizontalAlignment', 'left');
                %%%%%%%%%%%%%%%%%%%
                
                    % Plot the base attachment points
                
                    plot3(B(1,:), B(2,:), B(3,:), 'ro', 'MarkerSize', 10, 'MarkerFaceColor', 'r');
                    hold on
                    fill3(B(1,:), B(2,:), B(3,:),'r', 'FaceAlpha', 0.2);
                    text(B(1,:), B(2,:), B(3,:), {'B1', 'B2', 'B3', 'B4', 'B5', 'B6'}, 'VerticalAlignment', 'bottom', 'HorizontalAlignment', 'right');
                    
                    
                
                    % Plot the platform attachment points
                    plot3(P_global(1,:), P_global(2,:), P_global(3,:), 'bo', 'MarkerSize', 10, 'MarkerFaceColor', 'b');
                    hold on
                    fill3(P_global(1,:), P_global(2,:), P_global(3,:),'b','FaceAlpha', 0.2);
                    text(P_global(1,:), P_global(2,:), P_global(3,:), {'P1', 'P2', 'P3', 'P4', 'P5', 'P6'}, 'VerticalAlignment', 'bottom', 'HorizontalAlignment', 'left');
                    
                    
                    % Plot the legs
                    for i = 1:6
                        plot3([B(1,i), P_global(1,i)], [B(2,i), P_global(2,i)], [B(3,i), P_global(3,i)], 'k-');
                    end
                
                
                    %Plot Centre
                    top_centre = mean(P_global,2);
                    plot3(top_centre(1),top_centre(2),top_centre(3),'bo', 'MarkerSize', 10, 'MarkerFaceColor', 'b');
                    
                    % Plot settings
                    xlabel('X');
                    ylabel('Y');
                    zlabel('Z');
                    title('Stewart Platform (Inverse)');
                    grid on;
                    axis equal;
                    view(3);
                    hold off;
                end
                
                
